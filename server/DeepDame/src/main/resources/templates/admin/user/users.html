<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management | DeepDame</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link th:href="@{/css/admin.css}" rel="stylesheet">

    <style>
        .deepdame-container { width: 100%; max-width: 1300px; margin: 0 auto; }
        .table-card {
            background: white;
            border-radius: 12px;
            border: 1px solid rgba(0,0,0,0.05);
            overflow: hidden;
        }

        /* Row Interactivity */
        tbody tr {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        tbody tr:hover {
            background-color: rgba(115, 147, 126, 0.05) !important;
        }

        .btn-action-edit { color: var(--soft-gold); border: 1px solid var(--soft-gold); }
        .btn-action-edit:hover { background-color: var(--soft-gold); color: white; }

        .btn-action-ban { color: var(--dusty-clay); border: 1px solid var(--dusty-clay); }
        .btn-action-ban:hover:not(:disabled) { background-color: var(--dusty-clay); color: white; }

        .icon-verified { color: var(--soft-gold); }
        .badge-role {
            background-color: var(--bg-cream);
            color: var(--sage-dark);
            border: 1px solid var(--sage-light);
        }

        body { display: block; }
    </style>
</head>
<body>

<div th:replace="~{admin/fragments/header :: adminHeader}"></div>

<main class="deepdame-container px-4">
    <div class="mb-4">
        <h2 style="font-family: 'Georgia', serif; color: var(--sage-dark); font-weight: bold;">User Management</h2>
        <p class="text-muted">Review and manage DeepDame member accounts. <small>(Double-click a row to view details)</small></p>
    </div>

    <div class="table-card shadow-sm">
        <div class="table-responsive">
            <table class="table mb-0 align-middle">
                <thead style="background-color: var(--bg-cream);">
                <tr>
                    <th class="py-3 px-4">User</th>
                    <th>Email</th>
                    <th>Validated</th>
                    <th>Roles</th>
                    <th>Status</th>
                    <th class="text-end px-4">Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="user : ${users}"
                    th:ondblclick="|window.location.href='@{/admin/users/details/{id}(id=${user.id})}'|">

                    <td class="px-4">
                        <span class="fw-bold" th:text="${user.username}">Username</span>
                    </td>
                    <td>
                        <span th:text="${user.email}">email@gmail.com</span>
                    </td>
                    <td>
                        <span th:if="${user.emailValidated}" class="icon-verified ms-1" title="Verified">Verified</span>
                    </td>
                    <td>
                        <span th:each="role : ${user.roles}" class="badge badge-role me-1" th:text="${role.name}">ROLE</span>
                    </td>
                    <td>
                        <span th:if="${user.bannedFromApp}" class="badge rounded-pill" style="background-color: var(--dusty-clay);">BANNED</span>
                        <span th:unless="${user.bannedFromApp}" class="badge rounded-pill" style="background-color: var(--sage-primary);">ACTIVE</span>
                    </td>
                    <td class="text-end px-4" ondblclick="event.stopPropagation();">
                        <a th:href="@{/admin/users/ban/{id}(id=${user.id})}" class="btn btn-sm btn-action-edit">Edit</a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</main>

</body>
</html>